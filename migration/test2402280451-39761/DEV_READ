s :: Script(
	TYPE ACTIVE,
	set RUNNING 1,
    set launched 0,
    set lastdrop 0,
    set stime $(now),
    set lasttime $stime,
	// Show queue statistics only if the flag is set to 1
	wait 5s,
    label loop,
    set ntime $(now),
	set time $(sub $ntime $stime),
	print "",
	
    print "",

//    read fd0.queue_count,
  
    	print $time"-RESULT-IQUEUE-PKTS-0 "$(queuecount/q0.count), print $time"-RESULT-IQUEUE-BYTES-0 "$(queuecount/q0.byte_count), print $time"-RESULT-ICPU-0 "$(load 0), 
  	print $time"-RESULT-IQUEUE-PKTS-1 "$(queuecount/q1.count), print $time"-RESULT-IQUEUE-BYTES-1 "$(queuecount/q1.byte_count), print $time"-RESULT-ICPU-1 "$(load 1), 
  	print $time"-RESULT-IQUEUE-PKTS-2 "$(queuecount/q2.count), print $time"-RESULT-IQUEUE-BYTES-2 "$(queuecount/q2.byte_count), print $time"-RESULT-ICPU-2 "$(load 2), 
  	print $time"-RESULT-IQUEUE-PKTS-3 "$(queuecount/q3.count), print $time"-RESULT-IQUEUE-BYTES-3 "$(queuecount/q3.byte_count), print $time"-RESULT-ICPU-3 "$(load 3), 
  	print $time"-RESULT-IQUEUE-PKTS-4 "$(queuecount/q4.count), print $time"-RESULT-IQUEUE-BYTES-4 "$(queuecount/q4.byte_count), print $time"-RESULT-ICPU-4 "$(load 4), 
  	print $time"-RESULT-IQUEUE-PKTS-5 "$(queuecount/q5.count), print $time"-RESULT-IQUEUE-BYTES-5 "$(queuecount/q5.byte_count), print $time"-RESULT-ICPU-5 "$(load 5), 
  	print $time"-RESULT-IQUEUE-PKTS-6 "$(queuecount/q6.count), print $time"-RESULT-IQUEUE-BYTES-6 "$(queuecount/q6.byte_count), print $time"-RESULT-ICPU-6 "$(load 6), 
  	print $time"-RESULT-IQUEUE-PKTS-7 "$(queuecount/q7.count), print $time"-RESULT-IQUEUE-BYTES-7 "$(queuecount/q7.byte_count), print $time"-RESULT-ICPU-7 "$(load 7), 
  	print $time"-RESULT-IQUEUE-PKTS-8 "$(queuecount/q8.count), print $time"-RESULT-IQUEUE-BYTES-8 "$(queuecount/q8.byte_count), print $time"-RESULT-ICPU-8 "$(load 8), 
  	print $time"-RESULT-IQUEUE-PKTS-9 "$(queuecount/q9.count), print $time"-RESULT-IQUEUE-BYTES-9 "$(queuecount/q9.byte_count), print $time"-RESULT-ICPU-9 "$(load 9), 
  	print $time"-RESULT-IQUEUE-PKTS-10 "$(queuecount/q10.count), print $time"-RESULT-IQUEUE-BYTES-10 "$(queuecount/q10.byte_count), print $time"-RESULT-ICPU-10 "$(load 10), 
  	print $time"-RESULT-IQUEUE-PKTS-11 "$(queuecount/q11.count), print $time"-RESULT-IQUEUE-BYTES-11 "$(queuecount/q11.byte_count), print $time"-RESULT-ICPU-11 "$(load 11), 
  	print $time"-RESULT-IQUEUE-PKTS-12 "$(queuecount/q12.count), print $time"-RESULT-IQUEUE-BYTES-12 "$(queuecount/q12.byte_count), print $time"-RESULT-ICPU-12 "$(load 12), 
  	print $time"-RESULT-IQUEUE-PKTS-13 "$(queuecount/q13.count), print $time"-RESULT-IQUEUE-BYTES-13 "$(queuecount/q13.byte_count), print $time"-RESULT-ICPU-13 "$(load 13), 
  	print $time"-RESULT-IQUEUE-PKTS-14 "$(queuecount/q14.count), print $time"-RESULT-IQUEUE-BYTES-14 "$(queuecount/q14.byte_count), print $time"-RESULT-ICPU-14 "$(load 14), 
  	print $time"-RESULT-IQUEUE-PKTS-15 "$(queuecount/q15.count), print $time"-RESULT-IQUEUE-BYTES-15 "$(queuecount/q15.byte_count), print $time"-RESULT-ICPU-15 "$(load 15), 
  	print $time"-RESULT-IQUEUE-PKTS-16 "$(queuecount/q16.count), print $time"-RESULT-IQUEUE-BYTES-16 "$(queuecount/q16.byte_count), print $time"-RESULT-ICPU-16 "$(load 16), 
  	print $time"-RESULT-IQUEUE-PKTS-17 "$(queuecount/q17.count), print $time"-RESULT-IQUEUE-BYTES-17 "$(queuecount/q17.byte_count), print $time"-RESULT-ICPU-17 "$(load 17), 

    set ncpu $(gt_vec 0.05  $(load)),
    goto ctn $(eq $launched 1),
    goto ctn $(eq $ncpu 0),
    print "EVENT LOAD_START",
    set launched 1,
    print "Launching migration driver!",
    write migratedrv.run 1,
    label ctn,
    set packets $(legit.count),
    set bytes $(legit.byte_count),
    set nbytes $(sub $bytes $lastbytes),
    set npackets $(sub $packets $lastpackets),
	set diff $(sub $ntime $lasttime),
    set lasttime $ntime,

    print "$time-RESULT-DTTHROUGHPUT $(legit.link_rate)",
    print "$time-RESULT-DUTTHROUGHPUT $(div $(mul 8 $(add $nbytes $(mul $npackets 24) )) $diff)",
    set lastbytes $bytes,
    set lastpackets $packets,
    print "$time-RESULT-LOAD $(add $(load))",
    print "$time-RESULT-CPU $(div $(add $(load)) $ncpu)",
    print "$time-RESULT-NCPU $ncpu",
    print "$time-RESULT-MAXCPU $(count $(load))",
    set drop $(fd0.hw_dropped),
    print "$time-RESULT-MISSED $(sub $drop $lastdrop)",
	wait 0.2s,
	goto loop $(eq $RUNNING 1),
);

